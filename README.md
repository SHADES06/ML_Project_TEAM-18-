# ML_Project_TEAM-18-
Reinforcement Learning–Based Threat Prioritization Using Sysmon Logs

This project implements a complete end-to-end CTI (Cyber Threat Intelligence) pipeline that collects Sysmon logs, extracts malicious + benign behaviors, generates embeddings, stores them in a vector database, scores severity using MITRE ATT&CK patterns, and finally trains a Reinforcement Learning agent to prioritize high-risk events.

This system helps SOC analysts reduce alert fatigue by ranking threats based on risk and severity.

 Final Outputs (Main Results)
 1. Final Prioritized Threats (sorted by risk)

Generated by:

python generate_final_output.py


Output saved to:

C:\CTI_Pipeline\logs\final_prioritized_events.csv


Terminal Output:

Top 10 High-Risk Events:

C:\Windows\System32\ipconfig.exe  /all             severity 8.0 → final score 8.0
C:\Windows\System32\NETSTAT.EXE   -ano             severity 8.0 → final score 8.0
...

 2. RL Policy Evaluation (NDCG + Precision)

Generated by:

python evaluate_policy.py


Output:

=== RL Evaluation Metrics ===
NDCG@10: 1.0000
Precision@10: 1.0000


This shows the RL agent is ranking threats perfectly at top-10.

 Project Pipeline
1. Install and configure Sysmon
2. Collect benign + malicious data
3. Parse Sysmon logs → CSV
4. Preprocess & clean text
5. Generate embeddings (MiniLM)
6. Store embeddings in ChromaDB
7. Detect malicious patterns using MITRE ATT&CK
8. Score severity
9. Train RL agent (Gymnasium environment)
10. Evaluate policy
11. Generate final risk-prioritized events

 Project Structure
CTI_Project/
│
├── collect_benign_data.ps1
├── simulate_malicious.ps1
├── export_logs.ps1
├── export_malicious_logs.ps1
├── parse_sysmon_logs.py
├── preprocess_text.py
├── generate_embeddings.py
├── setup_vectordb.py
├── label_events.py
├── score_severity.py
├── rl_env.py
├── train_rl.py
├── evaluate_policy.py
├── generate_final_output.py
├── trained_policy.npy
└── README.md

 Datasets Used

All collected data stored in:

C:\CTI_Pipeline\logs\


Important files:

File	Description
benign_events.csv	Normal Sysmon activity
malicious_events.csv	Simulated attacks (ipconfig, netstat, system discovery)
structured_events.csv	Parsed Sysmon logs
preprocessed_events.csv	Cleaned + normalized text
embeddings.npy	MiniLM embeddings
labeled_events.csv	MITRE-labeled dataset
scored_events.csv	Severity-scored events
final_prioritized_events.csv	FINAL OUTPUT
 Machine Learning Components
1. Embedding Model

sentence-transformers/all-MiniLM-L6-v2

Output dimension: 384

Combined with categorical features → vector dim 390

2. Vector Database

ChromaDB local persistent storage

3. Severity Scoring

Based on:

MITRE technique

Event type

Process name

Command-line patterns

4. RL Training

Custom Gymnasium environment

Simple MLP policy trained using:

Reward = high for catching malicious events

Reward penalty for mislabeling benign

 Final Model Performance
 Reinforcement Learning Metrics
Metric	Score
NDCG@10	1.0000
Precision@10	1.0000

Means:
 Model ranked all malicious events at the top
 Perfect prioritization accuracy

How to Run the Full Pipeline
Step 1 — Collect Data
.\collect_benign_data.ps1
.\simulate_malicious.ps1
.\export_logs.ps1
.\export_malicious_logs.ps1

Step 2 — Parse & Preprocess
python parse_sysmon_logs.py
python preprocess_text.py

Step 3 — Generate Embeddings
python generate_embeddings.py

Step 4 — Build VectorDB
python setup_vectordb.py

Step 5 — Label & Score
python label_events.py
python score_severity.py

Step 6 — Train RL Agent
python train_rl.py

Step 7 — Evaluate
python evaluate_policy.py

Step 8 — Generate Final Output
python generate_final_output.py
